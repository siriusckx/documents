## 一、需求分析

### 1.1  性能

目前北、上机房写数据较慢，目标是提升盘后落地数据的性能，最后能在1小时到2小时内落完。

### 1.2  扩展性

考虑到落盘的数据，会以各种各样的形式，提供给其他的公司或者友商使用（这个暂且先放后面考虑）。

### 1.3 兼容性

在只改动 persist ，并且尽量少改动的情况下，达到性能提升的效果。

## 二、总体设计

### 2.1 文件系统选型

针对各文件系统进行比较，目前入选的主要有`glusterfs`，`MinIO` 其他的分布方式文件系统要么太小众，要么学习维护成本太大。`glusterfs`和`MinIO`各有优缺点，相对来说`glusterfs`目前是最适合于我们的，在对`MinIO`进行使用的过程中，得出如下结论，使用详情参见：[MinIO实践](./MinIO/MinIO实践.md)

1. 对少量的服务器节点和较老的服务器和硬盘来说，`minio`的性能不如`glusterfs`，`minio`更适合大批量的云场景，其性能摊平后很可观。
2. `minio`采用的是对象存储，其与现有程序以及相关运维脚本的兼容性来说，改动成本会较大。
3. `minio`最近发布的版本到2020年的最新版本，在使用上会出现多多少少的一些崩溃问题，且每3~6天更新一个版本，还处于快速迭代中。
4. `minio`前景很不错，部署、升级很方便，基于`minio`做数据分析很方便，待完全稳定后，可以看当时的情况选择使用`minio`

> 基于如上的验证得出的结论，在当前设施环境下，要想提高存储层的性能，则需要考虑提高对硬盘的利用通过增加对硬盘的顺序读和顺序写，从而达到提升IO的能力。

### 2.2 提升 IO 设计

#### 2.2.1 横向文件合并

在市场之下，股票代码层面，按照不同的周期，以日期为一个文件，该文件里面存放所有的股票信息。

| 优点                | 缺点                                                        |
| ------------------- | ----------------------------------------------------------- |
| ①适合于外部获取数据 | ①不适合内部结构使用<br/>②取一只代码，会把所有的代码取出来。 |

#### 2.2.2 纵向文件合并

在市场之下，股票代码层面，按照不同的周期，将所有过去到现在的历史数据存成一个或多个文件，具体如下：

**分钟周期文件**：文件跨度变成 5 分钟周期，这样分钟 K 线的文件个数，可以缩小为原来的 1/3左右，在做兼容性方面计算文件周期时只需要做一点小小的改动。

**0周期文件**：文件跨度变成 1 年，这样0周期文件个数，可以缩小为原来的 1/244 左右，单个文件块压缩后，在40 M 左右，在做兼容性方面，要能够提供文件的随机读功能。最新1年的数据，需要保留1天1个文件，历史的数据，如2021年以前数据，变成1年1个文件。（这里1年1个文件，需要根据实际随机读数据的情况，可能会做一些调整）该方法的难点在于如何在合并后的大文件中快速找出需要的数据，并做好向下兼容，同时要提防大批量随机请求历史分笔数据操作。

| 优点                                                         | 缺点                                  |
| ------------------------------------------------------------ | ------------------------------------- |
| ①可以大大提升 GlusterFS 文件系统定位文件的效率；<br/>②可以更好的利用硬盘的顺序读的功能。顺序读写的基准性能，[参考硬件基准测试](#3.2) | ①需要从比较大的历史文件里面查找数据。 |

#### 2.2.3 文件合并详细设计

1. 程序新旧版本的兼容性

   > 采取开关的形式，默认保持原来的逻辑，在配置启动后，才使用新的逻辑。

2. 程序与下游模块的兼容性

   * 对于分钟周期数据

     > 下游请求如果是 `FullFile` 形式，需先经过计算，转换成 `MinData` 模式后，再去取数据。

   * 对于 0 周期数据

     > 最近一年的数据，则按照以前的逻辑来处理，1年以前的请求，需先经过计算，转换成 `MinData` 模式后，再去取数据。(这里还要看对过去一年数据的压缩方式)。

3. 程序新旧数据的兼容性

   * 对于分钟周期数据

     > 先寻找新的文件块，如果找到了，则按照 `程序与下游模块的兼容性` 来处理，如果没找到，则按照老的逻辑来进行处理。

   * 对于 0 周期数据

     > 先按不同的时间进行划分，是最近 1 年的数据，直接读文件即可。如果是1 年前的数据，先将文件取出来进行解压，再从解压的文件里面取出对应日期的文件，再根据 `程序与下游模块的兼容性` 进行数据组装。
     >
4. 对历史数据和当天实时数据的兼容性

   * 对于分钟周期数据
   * 对于 0 周期数据

5. 编码的质量

   考虑到以上步骤2和步骤3两者纠缠在一起，会较为复杂，且不易理解，需要进行一个较好的设计。

### 2.3  对Glusterfs性能做优化

从对 `GlusterFS` 文档进一步的查看以及对 `GlusterFS`实现原理的了解，`GlusterFS` 本身对小文本不是很有效，但随着越来越多对小文件的效率的提升，在 `3.6` 版本以后，其内部有针对小文件查找的一些性能提升做过优化，需要根据场景做一些参数调优，这个需要更多的验证。

## 三、硬件基本信息

### 3.1 硬件参数信息

| 主要IDC  | 硬盘类型                                                     | 转速  | 最大传输速率 |
| -------- | ------------------------------------------------------------ | ----- | ------------ |
| 上海     | Vendor:               SEAGATE<br/>Product:              ST1000NM0045<br/>Revision:             DS03<br/>Compliance:           SPC-4<br/>User Capacity:        1,000,204,886,016 bytes [1.00 TB]<br/>Logical block size:   512 bytes<br/>Rotation Rate:        7200 rpm<br/>Form Factor:          3.5 inches<br/>Logical Unit id:      0x5000c5008603fd13<br/>Serial number:        ZBS03D5E<br/>Device type:          disk<br/>Transport protocol:   SAS (SPL-3)<br/> | 7200  | 12G          |
| 北京70   | Vendor:               SEAGATE<br/>Product:              ST3300657SS<br/>Revision:             ES65<br/>Compliance:           SPC-3<br/>User Capacity:        300,000,000,000 bytes [300 GB]<br/>Logical block size:   512 bytes<br/>Rotation Rate:        15000 rpm<br/>Form Factor:          3.5 inches<br/>Logical Unit id:      0x5b4525304dedafd3<br/>Device type:          disk<br/>Transport protocol:   SAS (SPL-3)<br/> | 15000 | 12G          |
| 北京73   | Vendor:               SEAGATE<br/>Product:              ST1000NM0045<br/>Revision:             DS03<br/>Compliance:           SPC-4<br/>User Capacity:        1,000,204,886,016 bytes [1.00 TB]<br/>Logical block size:   512 bytes<br/>Formatted with type 2 protection<br/>8 bytes of protection information per logical block<br/>LU is fully provisioned<br/>Rotation Rate:        7200 rpm<br/>Form Factor:          3.5 inches<br/>Device type:          disk<br/>Transport protocol:   SAS (SPL-3)<br/> | 7200  | 12G          |
| 深圳     | 固态云盘(存储集群，硬盘用的SSD)                              | -     | -            |
| 较老硬盘 | Vendor:        HGST<br/>Product:       HUS724030ALS640<br/>Revision:       W1CG<br/>Compliance:      SPC-4 | 7200  | 6G           |

### 3.2 硬盘基准测试

以下先说测试的结论，测试的详情见后面每一个条目：

测试总结：**从测试的数据分析，在同样的情形下，顺序读的和顺序写的 IOPS 相较于随机读性能高出好几个数量积，缩减文件的个数，小文件合并成大文件对系统的性能是十分有利的，可以大幅度提升文件查找定位的性能，从而提升顺序读和顺序写的概率。**

> FIO 的一些参数说明，另外在做FIO的过程中，要保持使用率90%以上，测试效果才比较贴近，另外 `size`、`ioengine`、`iodepth`、`numjobs` 的值都会影响 IOPS 的值。
>
> `numjobs`:线程数，创建大于 1 的线程/进程来执行同一件事。随着 `numjobs` 的增大，`IOPS` 会增大。
>
> `iodepth`:队列深度。默认是 1 ，可以通过设置大于1的数来提升并发度。增加 `iodepth` 延时会增加。
>
> 综上：在测试过程中，要根据实际使用情况，设置 `numjobs` 和 `iodepth` 参数，并做相应的参考对比。

```ini
filename=/dev/emcpowerb　支持文件系统或者裸设备，-filename不要直接挂到正常使用的设备上测试，尤其名字同设备名称一样
direct=1                 测试过程绕过机器自带的buffer，使测试结果更真实
rw=randwread             测试随机读的I/O
rw=randwrite             测试随机写的I/O
rw=randrw                测试随机混合写和读的I/O
rw=read                  测试顺序读的I/O
rw=write                 测试顺序写的I/O
rw=rw                    测试顺序混合写和读的I/O
bs=4k                    单次io的块文件大小为4k
size=5g                  本次的测试文件大小为5g，以每次4k的io进行测试
numjobs=30               本次的测试线程为30，线程数的多少，会影响IO的利用率，如果利用率达到90%以上，可以少设置一些
runtime=1000             测试时间为1000秒，如果不写则一直将5g文件分4k每次写完为止
ioengine=libaio           io引擎使用pync方式，如果要使用libaio引擎，需要yum install libaio-devel包，linux下一般使用 libaio
rwmixwrite=30            在混合读写的模式下，写占30%
group_reporting          关于显示结果的，汇总每个进程的信息
此外
lockmem=1g               只使用1g内存进行测试
zero_buffers             用0初始化系统buffer
nrfiles=8                每个进程生成文件的数量
```

### 3.2.1 HGST HUS724030ALS640 基准测试

```shell
[root@localhost ~]# smartctl -a /dev/sda
smartctl 7.0 2018-12-30 r4883 [x86_64-linux-3.10.0-1062.18.1.el7.x86_64] (local build)
Copyright (C) 2002-18, Bruce Allen, Christian Franke, www.smartmontools.org

=== START OF INFORMATION SECTION ===
Vendor:               DELL
Product:              PERC H310
Revision:             2.12
Compliance:           SPC-3
User Capacity:        3,000,034,656,256 bytes [3.00 TB]
Logical block size:   512 bytes
Logical Unit id:      0x6c81f660f8beb8001b37494303285f74
Serial number:        00745f28034349371b00b8bef860f681
Device type:          disk
Local Time is:        Thu Dec 24 10:51:21 2020 CST
SMART support is:     Unavailable - device lacks SMART capability.
```

#### 3.2.1.1 顺序读用例

```shell
[root@localhost ~]# fio -filename=/home/emcpowerb -direct=1 -iodepth 1 -thread -rw=read -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=read_4k
```

```shell
read_4k: (g=0): rw=read, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [R(2)][100.0%][r=29.0MiB/s,w=0KiB/s][r=7670,w=0 IOPS][eta 00m:00s]
read_4k: (groupid=0, jobs=2): err= 0: pid=15364: Wed Dec 30 14:51:53 2020
   read: IOPS=7923, BW=30.0MiB/s (32.5MB/s)(5572MiB/180001msec)
    slat (usec): min=8, max=347, avg=16.12, stdev= 5.10
    clat (usec): min=3, max=42932, avg=232.90, stdev=152.33
     lat (usec): min=51, max=42958, avg=249.32, stdev=152.63
    clat percentiles (usec):
     |  1.00th=[  108],  5.00th=[  128], 10.00th=[  198], 20.00th=[  215],
     | 30.00th=[  223], 40.00th=[  225], 50.00th=[  227], 60.00th=[  229],
     | 70.00th=[  233], 80.00th=[  235], 90.00th=[  243], 95.00th=[  258],
     | 99.00th=[  603], 99.50th=[  775], 99.90th=[  865], 99.95th=[ 1057],
     | 99.99th=[ 7111]
   bw (  KiB/s): min=14192, max=31640, per=50.01%, avg=15849.27, stdev=2474.64, samples=718
   iops        : min= 3548, max= 7910, avg=3962.31, stdev=618.66, samples=718
  lat (usec)   : 4=0.01%, 10=0.01%, 50=0.01%, 100=0.23%, 250=93.00%
  lat (usec)   : 500=4.26%, 750=1.79%, 1000=0.66%
  lat (msec)   : 2=0.03%, 4=0.01%, 10=0.01%, 20=0.01%, 50=0.01%
  cpu          : usr=3.15%, sys=9.47%, ctx=1426386, majf=0, minf=239
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=1426323,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=30.0MiB/s (32.5MB/s), 30.0MiB/s-30.0MiB/s (32.5MB/s-32.5MB/s), io=5572MiB (5842MB), run=180001-180001msec

Disk stats (read/write):
    dm-2: ios=1425009/18, merge=0/0, ticks=319993/358, in_queue=320356, util=100.00%, aggrios=1426323/38, aggrmerge=0/0, aggrticks=318170/827, aggrin_queue=318151, aggrutil=100.00%
  sda: ios=1426323/38, merge=0/0, ticks=318170/827, in_queue=318151, util=100.00%
```

#### 3.2.1.2 顺序写用例

```shell
[root@localhost ~]# fio -filename=/home/emcpowerb -direct=1 -iodepth 1 -thread -rw=write -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=write_4k
```

```shell
write_4k: (g=0): rw=write, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [W(2)][100.0%][r=0KiB/s,w=848KiB/s][r=0,w=212 IOPS][eta 00m:00s]
write_4k: (groupid=0, jobs=2): err= 0: pid=16579: Wed Dec 30 15:01:15 2020
  write: IOPS=188, BW=754KiB/s (772kB/s)(133MiB/180042msec)
    slat (usec): min=17, max=223, avg=43.66, stdev= 6.51
    clat (usec): min=7219, max=99910, avg=10556.12, stdev=3884.22
     lat (usec): min=7259, max=99957, avg=10600.48, stdev=3885.23
    clat percentiles (usec):
     |  1.00th=[ 8225],  5.00th=[ 8291], 10.00th=[ 8291], 20.00th=[ 8291],
     | 30.00th=[ 8291], 40.00th=[ 8291], 50.00th=[ 8356], 60.00th=[11600],
     | 70.00th=[11863], 80.00th=[13042], 90.00th=[13304], 95.00th=[13566],
     | 99.00th=[33162], 99.50th=[37487], 99.90th=[44827], 99.95th=[46400],
     | 99.99th=[95945]
   bw (  KiB/s): min=  240, max=  480, per=50.01%, avg=377.07, stdev=69.00, samples=720
   iops        : min=   60, max=  120, avg=94.24, stdev=17.23, samples=720
  lat (msec)   : 10=54.50%, 20=43.97%, 50=1.51%, 100=0.02%
  cpu          : usr=0.16%, sys=0.67%, ctx=33997, majf=0, minf=42
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=0,33942,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
  WRITE: bw=754KiB/s (772kB/s), 754KiB/s-754KiB/s (772kB/s-772kB/s), io=133MiB (139MB), run=180042-180042msec

Disk stats (read/write):
    dm-2: ios=0/33933, merge=0/0, ticks=0/357922, in_queue=357922, util=99.68%, aggrios=0/33978, aggrmerge=0/0, aggrticks=0/358882, aggrin_queue=358838, aggrutil=99.63%
  sda: ios=0/33978, merge=0/0, ticks=0/358882, in_queue=358838, util=99.63%
```

#### 3.2.1.3 随机读用例

```shell
[root@localhost ~]# fio -filename=/home/emcpowerb -direct=1 -iodepth 1 -thread -rw=randread -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=randread_4k
```

```shell
randread_4k: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [r(2)][100.0%][r=952KiB/s,w=0KiB/s][r=238,w=0 IOPS][eta 00m:00s]
randread_4k: (groupid=0, jobs=2): err= 0: pid=17279: Wed Dec 30 15:06:32 2020
   read: IOPS=211, BW=848KiB/s (868kB/s)(149MiB/180007msec)
    slat (usec): min=12, max=290, avg=38.60, stdev= 4.78
    clat (usec): min=244, max=67600, avg=9390.57, stdev=6579.88
     lat (usec): min=283, max=67641, avg=9429.94, stdev=6580.04
    clat percentiles (usec):
     |  1.00th=[ 1860],  5.00th=[ 2507], 10.00th=[ 3163], 20.00th=[ 4424],
     | 30.00th=[ 5538], 40.00th=[ 6718], 50.00th=[ 7767], 60.00th=[ 8979],
     | 70.00th=[10159], 80.00th=[13173], 90.00th=[17695], 95.00th=[22414],
     | 99.00th=[33817], 99.50th=[39060], 99.90th=[50070], 99.95th=[53216],
     | 99.99th=[63177]
   bw (  KiB/s): min=  232, max=  608, per=50.03%, avg=423.74, stdev=65.63, samples=720
   iops        : min=   58, max=  152, avg=105.90, stdev=16.41, samples=720
  lat (usec)   : 250=0.01%, 1000=0.01%
  lat (msec)   : 2=1.47%, 4=15.14%, 10=52.10%, 20=24.50%, 50=6.67%
  lat (msec)   : 100=0.11%
  cpu          : usr=0.21%, sys=0.66%, ctx=38174, majf=0, minf=381
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=38143,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=848KiB/s (868kB/s), 848KiB/s-848KiB/s (868kB/s-868kB/s), io=149MiB (156MB), run=180007-180007msec

Disk stats (read/write):
    dm-2: ios=38099/13, merge=0/0, ticks=356750/8027, in_queue=364779, util=100.00%, aggrios=38143/36, aggrmerge=0/0, aggrticks=356988/43907, aggrin_queue=400841, aggrutil=100.00%
  sda: ios=38143/36, merge=0/0, ticks=356988/43907, in_queue=400841, util=100.00%
```

#### 3.2.1.4 随机写用例

```shell
[root@localhost ~]# fio -filename=/home/emcpowerb -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=randwrite_4k
```

```shell
randwrite_4k: (g=0): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [w(2)][100.0%][r=0KiB/s,w=600KiB/s][r=0,w=150 IOPS][eta 00m:00s]
randwrite_4k: (groupid=0, jobs=2): err= 0: pid=27172: Thu Dec 31 11:21:00 2020
  write: IOPS=153, BW=614KiB/s (629kB/s)(108MiB/180007msec)
    slat (usec): min=17, max=177, avg=49.13, stdev= 6.10
    clat (usec): min=2571, max=74999, avg=12974.39, stdev=4194.65
     lat (usec): min=2618, max=75046, avg=13024.35, stdev=4194.68
    clat percentiles (usec):
     |  1.00th=[ 5014],  5.00th=[ 7046], 10.00th=[ 8160], 20.00th=[ 9634],
     | 30.00th=[10683], 40.00th=[11600], 50.00th=[12649], 60.00th=[13566],
     | 70.00th=[14746], 80.00th=[16057], 90.00th=[17957], 95.00th=[19530],
     | 99.00th=[25560], 99.50th=[27919], 99.90th=[36963], 99.95th=[43254],
     | 99.99th=[64750]
   bw (  KiB/s): min=  248, max=  352, per=50.06%, avg=306.85, stdev=15.28, samples=720
   iops        : min=   62, max=   88, avg=76.68, stdev= 3.83, samples=720
  lat (msec)   : 4=0.24%, 10=23.10%, 20=72.37%, 50=4.25%, 100=0.03%
  cpu          : usr=0.15%, sys=0.60%, ctx=27667, majf=0, minf=369
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=0,27622,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
  WRITE: bw=614KiB/s (629kB/s), 614KiB/s-614KiB/s (629kB/s-629kB/s), io=108MiB (113MB), run=180007-180007msec

Disk stats (read/write):
    dm-2: ios=0/27618, merge=0/0, ticks=0/358349, in_queue=358366, util=100.00%, aggrios=0/27672, aggrmerge=0/0, aggrticks=0/359939, aggrin_queue=359899, aggrutil=100.00%
  sda: ios=0/27672, merge=0/0, ticks=0/359939, in_queue=359899, util=100.00%
```

#### 3.2.1.5 混合随机读70%，随机写30%

```shell
[root@localhost ~]# fio -filename=/home/emcpowerb -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=randwrite_read70_write30_4k
```

```shell
randwrite_read70_write30_4k: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [m(2)][100.0%][r=604KiB/s,w=248KiB/s][r=151,w=62 IOPS][eta 00m:00s]
randwrite_read70_write30_4k: (groupid=0, jobs=2): err= 0: pid=18439: Wed Dec 30 15:15:20 2020
   read: IOPS=148, BW=592KiB/s (607kB/s)(104MiB/180007msec)
    slat (usec): min=14, max=270, avg=42.01, stdev= 6.83
    clat (usec): min=236, max=79333, avg=8429.63, stdev=4641.57
     lat (usec): min=288, max=79372, avg=8472.40, stdev=4642.37
    clat percentiles (usec):
     |  1.00th=[ 1860],  5.00th=[ 2540], 10.00th=[ 3261], 20.00th=[ 4555],
     | 30.00th=[ 5735], 40.00th=[ 6783], 50.00th=[ 7832], 60.00th=[ 8848],
     | 70.00th=[ 9765], 80.00th=[11338], 90.00th=[14353], 95.00th=[16909],
     | 99.00th=[23987], 99.50th=[26346], 99.90th=[37487], 99.95th=[42206],
     | 99.99th=[55313]
   bw (  KiB/s): min=  160, max=  424, per=50.02%, avg=296.12, stdev=42.71, samples=720
   iops        : min=   40, max=  106, avg=73.97, stdev=10.69, samples=720
  write: IOPS=63, BW=254KiB/s (260kB/s)(44.7MiB/180007msec)
    slat (usec): min=21, max=352, avg=48.60, stdev= 6.53
    clat (usec): min=2116, max=71836, avg=11650.27, stdev=4821.93
     lat (usec): min=2163, max=71884, avg=11699.63, stdev=4822.08
    clat percentiles (usec):
     |  1.00th=[ 3818],  5.00th=[ 5604], 10.00th=[ 6652], 20.00th=[ 8029],
     | 30.00th=[ 8979], 40.00th=[ 9896], 50.00th=[10683], 60.00th=[11731],
     | 70.00th=[13173], 80.00th=[14877], 90.00th=[17433], 95.00th=[20317],
     | 99.00th=[27132], 99.50th=[31327], 99.90th=[41157], 99.95th=[42730],
     | 99.99th=[58459]
   bw (  KiB/s): min=   56, max=  216, per=49.99%, avg=126.97, stdev=25.80, samples=720
   iops        : min=   14, max=   54, avg=31.68, stdev= 6.44, samples=720
  lat (usec)   : 250=0.01%, 500=0.01%, 1000=0.02%
  lat (msec)   : 2=1.11%, 4=10.03%, 10=51.86%, 20=34.02%, 50=2.92%
  lat (msec)   : 100=0.01%
  cpu          : usr=0.20%, sys=0.73%, ctx=38145, majf=0, minf=374
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=26660,11436,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=592KiB/s (607kB/s), 592KiB/s-592KiB/s (607kB/s-607kB/s), io=104MiB (109MB), run=180007-180007msec
  WRITE: bw=254KiB/s (260kB/s), 254KiB/s-254KiB/s (260kB/s-260kB/s), io=44.7MiB (46.8MB), run=180007-180007msec

Disk stats (read/write):
    dm-2: ios=26634/11445, merge=0/0, ticks=223633/133492, in_queue=357128, util=100.00%, aggrios=26662/11491, aggrmerge=0/1, aggrticks=223810/135501, aggrin_queue=359250, aggrutil=100.00%
  sda: ios=26662/11491, merge=0/1, ticks=223810/135501, in_queue=359250, util=100.00%
```

#### 3.2.1.6 各场景下结果汇总

| 测试场景             | 任务数 | IO SIZE | 文件大小size | ioengine | IOPS           | 硬盘带宽                   | 硬盘使用率 | 平均IO时延(usec)         |
| -------------------- | ------ | ------- | ------------ | -------- | -------------- | -------------------------- | ---------- | ------------------------ |
| 顺序读               | 2      | 4K      | 10G          | libaio   | 7923           | 30.0MiB/s                  | 100%       | 249.32                   |
| 顺序写               | 2      | 4K      | 10G          | libaio   | 188            | 754KiB/s                   | 99.63%     | 10600.48                 |
| 随机读               | 2      | 4K      | 10G          | libaio   | 211            | 848KiB/s                   | 100%       | 9429.94                  |
| 随机写               | 2      | 4K      | 10G          | libaio   | 153            | 614KiB/s                   | 100%       | 13024.35                 |
| 随机读70%，随机写30% | 2      | 4K      | 10G          | libaio   | r:148<br/>w:63 | r:592.KiB/s<br/>w:254KiB/s | 100%       | r:8472.40<br/>w:11699.63 |

### 3.2.2 SEAGATE ST3300657SS 基准测试

#### 3.2.2.1 顺序读用例

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=read -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=read_4k
```

```shell
read_4k: (g=0): rw=read, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
read_4k: Laying out IO file (1 file / 10240MiB)
Jobs: 2 (f=2): [R(2)][100.0%][r=18.7MiB/s,w=0KiB/s][r=4790,w=0 IOPS][eta 00m:00s]
read_4k: (groupid=0, jobs=2): err= 0: pid=17426: Fri Jan  1 10:28:13 2021
   read: IOPS=21.7k, BW=84.8MiB/s (88.9MB/s)(14.9GiB/180012msec)
    slat (usec): min=5, max=170, avg= 6.96, stdev= 3.01
    clat (nsec): min=1027, max=419620k, avg=83799.99, stdev=433725.16
     lat (usec): min=52, max=419648, avg=90.95, stdev=434.78
    clat percentiles (usec):
     |  1.00th=[   51],  5.00th=[   52], 10.00th=[   53], 20.00th=[   53],
     | 30.00th=[   53], 40.00th=[   54], 50.00th=[   55], 60.00th=[   56],
     | 70.00th=[   56], 80.00th=[   57], 90.00th=[   60], 95.00th=[   65],
     | 99.00th=[  302], 99.50th=[ 1045], 99.90th=[ 6456], 99.95th=[ 6587],
     | 99.99th=[ 8717]
   bw (  KiB/s): min= 1176, max=63648, per=50.00%, avg=43403.24, stdev=27690.02, samples=720
   iops        : min=  294, max=15912, avg=10850.81, stdev=6922.51, samples=720
  lat (usec)   : 2=0.01%, 50=0.65%, 100=95.23%, 250=2.35%, 500=1.16%
  lat (usec)   : 750=0.03%, 1000=0.05%
  lat (msec)   : 2=0.23%, 4=0.02%, 10=0.28%, 20=0.01%, 50=0.01%
  lat (msec)   : 250=0.01%, 500=0.01%
  cpu          : usr=3.25%, sys=11.74%, ctx=3906386, majf=0, minf=111
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=3906358,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=84.8MiB/s (88.9MB/s), 84.8MiB/s-84.8MiB/s (88.9MB/s-88.9MB/s), io=14.9GiB (16.0GB), run=180012-180012msec

Disk stats (read/write):
  sda: ios=3905403/6, merge=0/0, ticks=313242/568, in_queue=312816, util=99.92%
```

#### 3.2.2.2 顺序写用例

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=write -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=write_4k
```

```shell
write_4k: (g=0): rw=write, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [W(2)][100.0%][r=0KiB/s,w=16.3MiB/s][r=0,w=4181 IOPS][eta 00m:00s]2m:24s]
write_4k: (groupid=0, jobs=2): err= 0: pid=19425: Fri Jan  1 10:35:26 2021
  write: IOPS=4010, BW=15.7MiB/s (16.4MB/s)(2820MiB/180001msec)
    slat (usec): min=5, max=202, avg=16.14, stdev= 7.95
    clat (usec): min=111, max=7176, avg=478.95, stdev=169.87
     lat (usec): min=225, max=7187, avg=495.49, stdev=169.75
    clat percentiles (usec):
     |  1.00th=[  285],  5.00th=[  310], 10.00th=[  326], 20.00th=[  355],
     | 30.00th=[  379], 40.00th=[  404], 50.00th=[  424], 60.00th=[  457],
     | 70.00th=[  502], 80.00th=[  578], 90.00th=[  725], 95.00th=[  865],
     | 99.00th=[ 1020], 99.50th=[ 1057], 99.90th=[ 1205], 99.95th=[ 1385],
     | 99.99th=[ 2343]
   bw (  KiB/s): min= 5520, max= 9205, per=50.00%, avg=8020.70, stdev=564.46, samples=718
   iops        : min= 1380, max= 2301, avg=2005.15, stdev=141.11, samples=718
  lat (usec)   : 250=0.02%, 500=69.79%, 750=21.37%, 1000=7.50%
  lat (msec)   : 2=1.29%, 4=0.03%, 10=0.01%
  cpu          : usr=1.44%, sys=4.65%, ctx=721997, majf=0, minf=233
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=0,721905,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
  WRITE: bw=15.7MiB/s (16.4MB/s), 15.7MiB/s-15.7MiB/s (16.4MB/s-16.4MB/s), io=2820MiB (2957MB), run=180001-180001msec

Disk stats (read/write):
  sda: ios=0/721528, merge=0/0, ticks=0/342528, in_queue=342069, util=99.89%
```

#### 3.2.2.3 随机读用例

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=randread -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=randread_4k
```

```shell
randread_4k: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [r(2)][100.0%][r=996KiB/s,w=0KiB/s][r=249,w=0 IOPS][eta 00m:00s]
randread_4k: (groupid=0, jobs=2): err= 0: pid=23897: Fri Jan  1 10:51:46 2021
   read: IOPS=250, BW=1001KiB/s (1025kB/s)(176MiB/180005msec)
    slat (usec): min=15, max=163, avg=30.62, stdev= 3.78
    clat (usec): min=288, max=75473, avg=7955.86, stdev=5406.07
     lat (usec): min=320, max=75502, avg=7987.26, stdev=5406.10
    clat percentiles (usec):
     |  1.00th=[ 1680],  5.00th=[ 2245], 10.00th=[ 2769], 20.00th=[ 3785],
     | 30.00th=[ 4752], 40.00th=[ 5800], 50.00th=[ 6849], 60.00th=[ 7832],
     | 70.00th=[ 8848], 80.00th=[10159], 90.00th=[15533], 95.00th=[17957],
     | 99.00th=[26608], 99.50th=[31851], 99.90th=[42206], 99.95th=[44303],
     | 99.99th=[59507]
   bw (  KiB/s): min=  376, max=  624, per=50.02%, avg=500.18, stdev=41.24, samples=720
   iops        : min=   94, max=  156, avg=125.02, stdev=10.31, samples=720
  lat (usec)   : 500=0.01%
  lat (msec)   : 2=2.94%, 4=19.13%, 10=57.18%, 20=17.33%, 50=3.40%
  lat (msec)   : 100=0.02%
  cpu          : usr=0.23%, sys=0.65%, ctx=45037, majf=0, minf=197
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=45024,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=1001KiB/s (1025kB/s), 1001KiB/s-1001KiB/s (1025kB/s-1025kB/s), io=176MiB (184MB), run=180005-180005msec

Disk stats (read/write):
  sda: ios=44991/6, merge=0/0, ticks=356764/3, in_queue=356713, util=99.98%
```

#### 3.2.2.4 随机写用例

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=randwrite_4k
```

```shell
randwrite_4k: (g=0): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [w(2)][100.0%][r=0KiB/s,w=2134KiB/s][r=0,w=533 IOPS][eta 00m:00s]
randwrite_4k: (groupid=0, jobs=2): err= 0: pid=25490: Fri Jan  1 10:57:30 2021
  write: IOPS=639, BW=2556KiB/s (2617kB/s)(449MiB/180015msec)
    slat (usec): min=9, max=361, avg=35.61, stdev= 9.86
    clat (usec): min=234, max=63654, avg=3084.60, stdev=3182.84
     lat (usec): min=269, max=63695, avg=3120.97, stdev=3182.40
    clat percentiles (usec):
     |  1.00th=[  375],  5.00th=[  482], 10.00th=[  652], 20.00th=[ 1319],
     | 30.00th=[ 1565], 40.00th=[ 1975], 50.00th=[ 2343], 60.00th=[ 2638],
     | 70.00th=[ 3097], 80.00th=[ 3949], 90.00th=[ 5997], 95.00th=[ 9765],
     | 99.00th=[14484], 99.50th=[16581], 99.90th=[30016], 99.95th=[53216],
     | 99.99th=[58459]
   bw (  KiB/s): min=  552, max= 3369, per=50.00%, avg=1277.93, stdev=209.58, samples=720
   iops        : min=  138, max=  842, avg=319.47, stdev=52.39, samples=720
  lat (usec)   : 250=0.01%, 500=5.79%, 750=5.83%, 1000=2.50%
  lat (msec)   : 2=26.46%, 4=39.92%, 10=15.02%, 20=4.27%, 50=0.11%
  lat (msec)   : 100=0.08%
  cpu          : usr=0.62%, sys=1.84%, ctx=115065, majf=0, minf=2171
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=0,115030,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
  WRITE: bw=2556KiB/s (2617kB/s), 2556KiB/s-2556KiB/s (2617kB/s-2617kB/s), io=449MiB (471MB), run=180015-180015msec

Disk stats (read/write):
  sda: ios=0/114954, merge=0/0, ticks=0/351913, in_queue=351745, util=99.81%
```

#### 3.2.2.5 混合随机读70%，随机写30%

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=randwrite_read70_write30_4k
```
```shell
randwrite_read70_write30_4k: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [m(2)][100.0%][r=628KiB/s,w=332KiB/s][r=157,w=83 IOPS][eta 00m:00s] 
randwrite_read70_write30_4k: (groupid=0, jobs=2): err= 0: pid=26552: Fri Jan  1 11:01:17 2021
   read: IOPS=192, BW=771KiB/s (790kB/s)(136MiB/180009msec)
    slat (usec): min=12, max=233, avg=33.72, stdev= 6.41
    clat (usec): min=228, max=131746, avg=9964.46, stdev=6644.29
     lat (usec): min=266, max=131778, avg=9998.97, stdev=6644.32
    clat percentiles (usec):
     |  1.00th=[ 1876],  5.00th=[ 2900], 10.00th=[ 3851], 20.00th=[ 5473],
     | 30.00th=[ 6783], 40.00th=[ 7963], 50.00th=[ 9110], 60.00th=[10159],
     | 70.00th=[11469], 80.00th=[13042], 90.00th=[15401], 95.00th=[17433],
     | 99.00th=[42206], 99.50th=[47973], 99.90th=[58459], 99.95th=[65799],
     | 99.99th=[90702]
   bw (  KiB/s): min=  240, max=  648, per=50.00%, avg=385.54, stdev=54.36, samples=720
   iops        : min=   60, max=  162, avg=96.35, stdev=13.59, samples=720
  write: IOPS=82, BW=331KiB/s (339kB/s)(58.2MiB/180009msec)
    slat (usec): min=10, max=124, avg=37.60, stdev= 6.12
    clat (usec): min=160, max=20336, avg=805.13, stdev=1190.79
     lat (usec): min=172, max=20374, avg=843.53, stdev=1191.02
    clat percentiles (usec):
     |  1.00th=[  212],  5.00th=[  262], 10.00th=[  302], 20.00th=[  359],
     | 30.00th=[  396], 40.00th=[  449], 50.00th=[  750], 60.00th=[  799],
     | 70.00th=[  832], 80.00th=[  881], 90.00th=[  971], 95.00th=[ 1270],
     | 99.00th=[ 7570], 99.50th=[10028], 99.90th=[14222], 99.95th=[15664],
     | 99.99th=[20055]
   bw (  KiB/s): min=   56, max=  328, per=50.12%, avg=165.38, stdev=48.44, samples=720
   iops        : min=   14, max=   82, avg=41.31, stdev=12.10, samples=720
  lat (usec)   : 250=1.16%, 500=11.72%, 750=2.29%, 1000=12.41%
  lat (msec)   : 2=2.58%, 4=6.84%, 10=34.21%, 20=26.43%, 50=2.12%
  lat (msec)   : 100=0.25%, 250=0.01%
  cpu          : usr=0.26%, sys=0.77%, ctx=49609, majf=0, minf=1753
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=34705,14889,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=771KiB/s (790kB/s), 771KiB/s-771KiB/s (790kB/s-790kB/s), io=136MiB (142MB), run=180009-180009msec
  WRITE: bw=331KiB/s (339kB/s), 331KiB/s-331KiB/s (339kB/s-339kB/s), io=58.2MiB (60.0MB), run=180009-180009msec

Disk stats (read/write):
  sda: ios=34683/14890, merge=0/0, ticks=344809/11732, in_queue=356475, util=99.98%
```

#### 3.2.1.6 各场景下结果汇总


| 测试场景             | 任务数 | IO SIZE | 文件大小size | ioengine | IOPS           | 硬盘带宽                  | 硬盘使用率 | 平均IO时延(usec)       |
| -------------------- | ------ | ------- | ------------ | -------- | -------------- | ------------------------- | ---------- | ---------------------- |
| 顺序读               | 2      | 4K      | 10G          | libaio   | 21.7k          | 84.8MiB/s                 | 99.92%     | 90.95                  |
| 顺序写               | 2      | 4K      | 10G          | libaio   | 4010           | 15.7MiB/s                 | 100%       | 495.49                 |
| 随机读               | 2      | 4K      | 10G          | libaio   | 250            | 1001KiB/s                 | 99.98%     | 7987.26                |
| 随机写               | 2      | 4K      | 10G          | libaio   | 639            | 2556KiB/s                 | 100%       | 3120.97                |
| 随机读70%，随机写30% | 2      | 4K      | 10G          | libaio   | r:172<br/>w:82 | r:771KiB/s<br/>w:331KiB/s | 99.98%     | r:9998.97<br/>w:843.53 |

### 3.2.3 固态云盘(存储集群)基准测试
#### 3.2.3.1 顺序读用例

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=read -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=read_4k
```

```shell
read_4k: (g=0): rw=read, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
read_4k: Laying out IO file (1 file / 10240MiB)
Jobs: 2 (f=2): [R(2)][100.0%][r=10.5MiB/s,w=0KiB/s][r=2690,w=0 IOPS][eta 00m:00s]
read_4k: (groupid=0, jobs=2): err= 0: pid=10933: Wed Dec 30 15:17:18 2020
   read: IOPS=2511, BW=9.81MiB/s (10.3MB/s)(1766MiB/180002msec)
    slat (usec): min=2, max=197, avg=11.41, stdev= 4.17
    clat (usec): min=50, max=353531, avg=781.19, stdev=1375.89
     lat (usec): min=59, max=353541, avg=793.15, stdev=1376.00
    clat percentiles (usec):
     |  1.00th=[  404],  5.00th=[  498], 10.00th=[  529], 20.00th=[  570],
     | 30.00th=[  603], 40.00th=[  635], 50.00th=[  668], 60.00th=[  701],
     | 70.00th=[  750], 80.00th=[  816], 90.00th=[  988], 95.00th=[ 1303],
     | 99.00th=[ 2573], 99.50th=[ 3916], 99.90th=[10028], 99.95th=[11600],
     | 99.99th=[51119]
   bw (  KiB/s): min=  320, max= 7304, per=50.00%, avg=5021.67, stdev=888.36, samples=720
   iops        : min=   80, max= 1826, avg=1255.40, stdev=222.09, samples=720
  lat (usec)   : 100=0.16%, 250=0.46%, 500=4.59%, 750=65.58%, 1000=19.67%
  lat (msec)   : 2=7.81%, 4=1.25%, 10=0.39%, 20=0.07%, 50=0.02%
  lat (msec)   : 100=0.01%, 250=0.01%, 500=0.01%
  cpu          : usr=0.82%, sys=2.40%, ctx=452008, majf=0, minf=11
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=451994,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=9.81MiB/s (10.3MB/s), 9.81MiB/s-9.81MiB/s (10.3MB/s-10.3MB/s), io=1766MiB (1851MB), run=180002-180002msec

Disk stats (read/write):
  vdb: ios=451934/9, merge=0/3, ticks=347091/15, in_queue=347763, util=98.57%
```

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=read -ioengine=libaio -bs=4k -size=10G -numjobs=50 -runtime=180 -group_reporting -name=read_4k
```

```shell
read_4k: (g=0): rw=read, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 50 threads
read_4k: Laying out IO file (1 file / 10240MiB)
Jobs: 50 (f=12): [f(10),R(1),f(7),R(1),f(10),R(1),f(5),R(2),f(2),R(1),f(10)][100.0%][r=111MiB/s,w=0KiB/s][r=28.3k,w=0 IOPS][eta 00m:00s]
read_4k: (groupid=0, jobs=50): err= 0: pid=28846: Thu Dec 31 15:46:26 2020
   read: IOPS=26.4k, BW=103MiB/s (108MB/s)(18.1GiB/180002msec)
    slat (nsec): min=1174, max=3026.7k, avg=10083.05, stdev=8116.03
    clat (usec): min=39, max=415960, avg=1878.45, stdev=3190.09
     lat (usec): min=53, max=415964, avg=1889.03, stdev=3190.10
    clat percentiles (usec):
     |  1.00th=[   807],  5.00th=[  1045], 10.00th=[  1156], 20.00th=[  1287],
     | 30.00th=[  1401], 40.00th=[  1500], 50.00th=[  1598], 60.00th=[  1713],
     | 70.00th=[  1860], 80.00th=[  2040], 90.00th=[  2442], 95.00th=[  3064],
     | 99.00th=[  7373], 99.50th=[ 10159], 99.90th=[ 20841], 99.95th=[ 33424],
     | 99.99th=[122160]
   bw (  KiB/s): min=   24, max= 3064, per=2.00%, avg=2113.94, stdev=466.50, samples=17956
   iops        : min=    6, max=  766, avg=528.45, stdev=116.62, samples=17956
  lat (usec)   : 50=0.01%, 100=0.04%, 250=0.18%, 500=0.12%, 750=0.40%
  lat (usec)   : 1000=3.03%
  lat (msec)   : 2=74.41%, 4=18.96%, 10=2.35%, 20=0.41%, 50=0.07%
  lat (msec)   : 100=0.02%, 250=0.01%, 500=0.01%
  cpu          : usr=0.26%, sys=0.87%, ctx=4757613, majf=0, minf=105
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=4757346,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=103MiB/s (108MB/s), 103MiB/s-103MiB/s (108MB/s-108MB/s), io=18.1GiB (19.5GB), run=180002-180002msec

Disk stats (read/write):
  vdb: ios=4751607/6, merge=0/0, ticks=8766060/201, in_queue=8797105, util=100.00%
```

#### 3.2.3.2 顺序写用例

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=write -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=write_4k
```

```shell
write_4k: (g=0): rw=write, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [W(2)][100.0%][r=0KiB/s,w=37.5MiB/s][r=0,w=9597 IOPS][eta 00m:00s]
write_4k: (groupid=0, jobs=2): err= 0: pid=14603: Wed Dec 30 15:23:40 2020
  write: IOPS=6489, BW=25.3MiB/s (26.6MB/s)(4563MiB/180002msec)
    slat (usec): min=2, max=1214, avg=10.70, stdev= 6.78
    clat (usec): min=29, max=138773, avg=294.21, stdev=412.95
     lat (usec): min=49, max=138783, avg=305.40, stdev=413.19
    clat percentiles (usec):
     |  1.00th=[   63],  5.00th=[   99], 10.00th=[  127], 20.00th=[  176],
     | 30.00th=[  227], 40.00th=[  269], 50.00th=[  302], 60.00th=[  326],
     | 70.00th=[  351], 80.00th=[  375], 90.00th=[  416], 95.00th=[  461],
     | 99.00th=[  685], 99.50th=[  955], 99.90th=[ 1598], 99.95th=[ 2311],
     | 99.99th=[ 7701]
   bw (  KiB/s): min= 6968, max=21912, per=49.96%, avg=12969.29, stdev=3551.53, samples=719
   iops        : min= 1742, max= 5478, avg=3242.30, stdev=887.88, samples=719
  lat (usec)   : 50=0.05%, 100=5.06%, 250=29.80%, 500=61.94%, 750=2.33%
  lat (usec)   : 1000=0.36%
  lat (msec)   : 2=0.39%, 4=0.04%, 10=0.02%, 20=0.01%, 100=0.01%
  lat (msec)   : 250=0.01%
  cpu          : usr=1.70%, sys=5.75%, ctx=1200012, majf=0, minf=8
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=0,1168124,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
  WRITE: bw=25.3MiB/s (26.6MB/s), 25.3MiB/s-25.3MiB/s (26.6MB/s-26.6MB/s), io=4563MiB (4785MB), run=180002-180002msec

Disk stats (read/write):
  vdb: ios=0/1167193, merge=0/0, ticks=0/333647, in_queue=334171, util=96.02%
```

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=write -ioengine=libaio -bs=4k -size=10G -numjobs=50 -runtime=180 -group_reporting -name=write_4k
```

```shell
write_4k: (g=0): rw=write, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 50 threads
Jobs: 50 (f=50): [W(50)][100.0%][r=0KiB/s,w=27.0MiB/s][r=0,w=6921 IOPS][eta 00m:00s]
write_4k: (groupid=0, jobs=50): err= 0: pid=31104: Thu Dec 31 15:52:44 2020
  write: IOPS=11.9k, BW=46.3MiB/s (48.6MB/s)(8337MiB/180002msec)
    slat (nsec): min=1696, max=10152k, avg=28118.19, stdev=70207.38
    clat (usec): min=3, max=23447, avg=4185.43, stdev=2442.70
     lat (usec): min=142, max=23455, avg=4214.10, stdev=2445.05
    clat percentiles (usec):
     |  1.00th=[  506],  5.00th=[  889], 10.00th=[ 1237], 20.00th=[ 1909],
     | 30.00th=[ 2540], 40.00th=[ 3130], 50.00th=[ 3785], 60.00th=[ 4555],
     | 70.00th=[ 5407], 80.00th=[ 6390], 90.00th=[ 7635], 95.00th=[ 8455],
     | 99.00th=[10421], 99.50th=[11207], 99.90th=[13042], 99.95th=[13960],
     | 99.99th=[16581]
   bw (  KiB/s): min=  400, max= 5312, per=2.00%, avg=948.83, stdev=588.39, samples=17979
   iops        : min=  100, max= 1328, avg=237.17, stdev=147.11, samples=17979
  lat (usec)   : 4=0.01%, 50=0.01%, 250=0.03%, 500=0.92%, 750=2.33%
  lat (usec)   : 1000=3.34%
  lat (msec)   : 2=14.77%, 4=31.61%, 10=45.50%, 20=1.49%, 50=0.01%
  cpu          : usr=0.10%, sys=0.68%, ctx=2223227, majf=0, minf=109
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=0,2134242,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
  WRITE: bw=46.3MiB/s (48.6MB/s), 46.3MiB/s-46.3MiB/s (48.6MB/s-48.6MB/s), io=8337MiB (8742MB), run=180002-180002msec

Disk stats (read/write):
  vdb: ios=0/2133489, merge=0/0, ticks=0/8871661, in_queue=8910154, util=100.00%
```

#### 3.2.3.3 随机读用例

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=randread -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=randread_4k
```

```shell
randread_4k: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [r(2)][100.0%][r=2286KiB/s,w=0KiB/s][r=571,w=0 IOPS][eta 00m:00s]
randread_4k: (groupid=0, jobs=2): err= 0: pid=8685: Wed Dec 30 15:36:13 2020
   read: IOPS=1232, BW=4930KiB/s (5049kB/s)(867MiB/180002msec)
    slat (usec): min=2, max=285, avg=13.51, stdev= 4.22
    clat (usec): min=62, max=1835.6k, avg=1604.44, stdev=11053.46
     lat (usec): min=72, max=1835.6k, avg=1618.52, stdev=11053.50
    clat percentiles (usec):
     |  1.00th=[   143],  5.00th=[   627], 10.00th=[   693], 20.00th=[   783],
     | 30.00th=[   857], 40.00th=[   947], 50.00th=[  1057], 60.00th=[  1188],
     | 70.00th=[  1336], 80.00th=[  1549], 90.00th=[  1860], 95.00th=[  2212],
     | 99.00th=[  6128], 99.50th=[ 13173], 99.90th=[ 99091], 99.95th=[183501],
     | 99.99th=[413139]
   bw (  KiB/s): min=   16, max= 4128, per=50.94%, avg=2511.17, stdev=994.26, samples=706
   iops        : min=    4, max= 1032, avg=627.79, stdev=248.57, samples=706
  lat (usec)   : 100=0.37%, 250=1.71%, 500=0.09%, 750=13.94%, 1000=29.12%
  lat (msec)   : 2=47.20%, 4=6.04%, 10=0.88%, 20=0.26%, 50=0.17%
  lat (msec)   : 100=0.10%, 250=0.07%, 500=0.02%, 750=0.01%, 1000=0.01%
  cpu          : usr=0.48%, sys=1.28%, ctx=221874, majf=0, minf=12
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=221868,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=4930KiB/s (5049kB/s), 4930KiB/s-4930KiB/s (5049kB/s-5049kB/s), io=867MiB (909MB), run=180002-180002msec

Disk stats (read/write):
  vdb: ios=221720/6, merge=0/0, ticks=353505/12, in_queue=353642, util=99.87%
You have new mail in /var/spool/mail/root
```

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=randread -ioengine=libaio -bs=4k -size=10G -numjobs=50 -runtime=180 -group_reporting -name=randread_4k
```

```shell
randread_4k: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 50 threads
Jobs: 50 (f=50): [r(50)][100.0%][r=19.7MiB/s,w=0KiB/s][r=5050,w=0 IOPS][eta 00m:00s]
randread_4k: (groupid=0, jobs=50): err= 0: pid=23381: Thu Dec 31 15:57:33 2020
   read: IOPS=7028, BW=27.5MiB/s (28.8MB/s)(4957MiB/180533msec)
    slat (nsec): min=1786, max=10987k, avg=13931.97, stdev=26630.54
    clat (usec): min=58, max=1778.4k, avg=7077.22, stdev=25275.84
     lat (usec): min=68, max=1778.4k, avg=7091.76, stdev=25275.80
    clat percentiles (usec):
     |  1.00th=[   734],  5.00th=[  1188], 10.00th=[  1811], 20.00th=[  3228],
     | 30.00th=[  4293], 40.00th=[  4948], 50.00th=[  5407], 60.00th=[  5866],
     | 70.00th=[  6325], 80.00th=[  6980], 90.00th=[  8029], 95.00th=[  9503],
     | 99.00th=[ 39060], 99.50th=[113771], 99.90th=[392168], 99.95th=[513803],
     | 99.99th=[918553]
   bw (  KiB/s): min=    7, max= 2544, per=2.05%, avg=575.05, stdev=198.85, samples=17647
   iops        : min=    1, max=  636, avg=143.72, stdev=49.72, samples=17647
  lat (usec)   : 100=0.02%, 250=0.15%, 500=0.14%, 750=0.81%, 1000=2.20%
  lat (msec)   : 2=8.12%, 4=15.50%, 10=68.83%, 20=2.86%, 50=0.50%
  lat (msec)   : 100=0.32%, 250=0.32%, 500=0.18%, 750=0.03%, 1000=0.01%
  cpu          : usr=0.11%, sys=0.32%, ctx=1269076, majf=0, minf=108
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=1268877,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=27.5MiB/s (28.8MB/s), 27.5MiB/s-27.5MiB/s (28.8MB/s-28.8MB/s), io=4957MiB (5197MB), run=180533-180533msec

Disk stats (read/write):
  vdb: ios=1268876/6, merge=0/0, ticks=8943972/37, in_queue=8968594, util=100.00%
```

#### 3.2.3.4 随机写用例

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=randwrite_4k
```

```shell
randwrite_4k: (g=0): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [w(2)][100.0%][r=0KiB/s,w=18.1MiB/s][r=0,w=4621 IOPS][eta 00m:00s]
randwrite_4k: (groupid=0, jobs=2): err= 0: pid=22361: Wed Dec 30 15:48:04 2020
  write: IOPS=5634, BW=22.0MiB/s (23.1MB/s)(3962MiB/180001msec)
    slat (usec): min=2, max=1176, avg=11.54, stdev= 7.27
    clat (usec): min=2, max=5906.0k, avg=339.36, stdev=17656.64
     lat (usec): min=50, max=5907.0k, avg=351.44, stdev=17656.67
    clat percentiles (usec):
     |  1.00th=[   69],  5.00th=[   81], 10.00th=[   87], 20.00th=[   97],
     | 30.00th=[  110], 40.00th=[  133], 50.00th=[  174], 60.00th=[  221],
     | 70.00th=[  277], 80.00th=[  355], 90.00th=[  498], 95.00th=[  660],
     | 99.00th=[ 1123], 99.50th=[ 1369], 99.90th=[ 2376], 99.95th=[ 3818],
     | 99.99th=[11076]
   bw (  KiB/s): min=    8, max=40032, per=63.34%, avg=14275.77, stdev=8503.14, samples=567
   iops        : min=    2, max=10008, avg=3568.93, stdev=2125.78, samples=567
  lat (usec)   : 4=0.01%, 50=0.01%, 100=23.13%, 250=42.42%, 500=24.48%
  lat (usec)   : 750=6.50%, 1000=2.03%
  lat (msec)   : 2=1.28%, 4=0.11%, 10=0.03%, 20=0.01%, 50=0.01%
  lat (msec)   : 100=0.01%, 750=0.01%
  cpu          : usr=1.73%, sys=5.39%, ctx=1034495, majf=0, minf=8
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=0,1014180,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
  WRITE: bw=22.0MiB/s (23.1MB/s), 22.0MiB/s-22.0MiB/s (23.1MB/s-23.1MB/s), io=3962MiB (4154MB), run=180001-180001msec

Disk stats (read/write):
  vdb: ios=0/1013714, merge=0/0, ticks=0/477757, in_queue=478572, util=98.64%
```

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=libaio -bs=4k -size=10G -numjobs=50 -runtime=180 -group_reporting -name=randwrite_4k
```

```shell
randwrite_4k: (g=0): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 50 threads
Jobs: 50 (f=50): [w(50)][100.0%][r=0KiB/s,w=21.9MiB/s][r=0,w=5614 IOPS][eta 00m:00s]
randwrite_4k: (groupid=0, jobs=50): err= 0: pid=5722: Thu Dec 31 16:33:31 2020
  write: IOPS=6507, BW=25.4MiB/s (26.7MB/s)(4576MiB/180017msec)
    slat (nsec): min=1888, max=7203.0k, avg=29665.18, stdev=81165.36
    clat (usec): min=77, max=3442.3k, avg=7648.67, stdev=51830.75
     lat (usec): min=95, max=3442.3k, avg=7678.93, stdev=51830.88
    clat percentiles (usec):
     |  1.00th=[    603],  5.00th=[   1090], 10.00th=[   1188],
     | 20.00th=[   1696], 30.00th=[   4047], 40.00th=[   6652],
     | 50.00th=[   7373], 60.00th=[   8029], 70.00th=[   8717],
     | 80.00th=[   9634], 90.00th=[  10945], 95.00th=[  12387],
     | 99.00th=[  16057], 99.50th=[  17957], 99.90th=[  38011],
     | 99.95th=[ 566232], 99.99th=[3204449]
   bw (  KiB/s): min=   16, max= 3336, per=2.21%, avg=574.76, stdev=450.60, samples=16300
   iops        : min=    4, max=  834, avg=143.64, stdev=112.65, samples=16300
  lat (usec)   : 100=0.01%, 250=0.01%, 500=0.44%, 750=1.20%, 1000=1.10%
  lat (msec)   : 2=18.73%, 4=8.43%, 10=53.34%, 20=16.39%, 50=0.29%
  lat (msec)   : 100=0.02%, 250=0.01%, 750=0.02%, 1000=0.01%
  cpu          : usr=0.07%, sys=0.38%, ctx=1230311, majf=0, minf=57
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=0,1171467,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
  WRITE: bw=25.4MiB/s (26.7MB/s), 25.4MiB/s-25.4MiB/s (26.7MB/s-26.7MB/s), io=4576MiB (4798MB), run=180017-180017msec

Disk stats (read/write):
  vdb: ios=0/1170880, merge=0/0, ticks=0/8951678, in_queue=8997797, util=100.00%
```

#### 3.2.3.5 混合随机读70%，随机写30%

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=libaio -bs=4k -size=10G -numjobs=2 -runtime=180 -group_reporting -name=randwrite_read70_write30_4k
```
```shell
randwrite_read70_write30_4k: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 2 threads
Jobs: 2 (f=2): [m(2)][100.0%][r=6204KiB/s,w=2712KiB/s][r=1551,w=678 IOPS][eta 00m:00s]
randwrite_read70_write30_4k: (groupid=0, jobs=2): err= 0: pid=24987: Wed Dec 30 15:53:33 2020
   read: IOPS=1252, BW=5010KiB/s (5131kB/s)(881MiB/180002msec)
    slat (usec): min=2, max=1076, avg=14.20, stdev= 5.45
    clat (usec): min=52, max=2632.9k, avg=1515.58, stdev=17846.59
     lat (usec): min=60, max=2632.9k, avg=1530.33, stdev=17846.63
    clat percentiles (usec):
     |  1.00th=[    120],  5.00th=[    619], 10.00th=[    668],
     | 20.00th=[    734], 30.00th=[    799], 40.00th=[    865],
     | 50.00th=[    955], 60.00th=[   1074], 70.00th=[   1237],
     | 80.00th=[   1450], 90.00th=[   1745], 95.00th=[   2073],
     | 99.00th=[   4555], 99.50th=[   7832], 99.90th=[  52691],
     | 99.95th=[ 145753], 99.99th=[1098908]
   bw (  KiB/s): min=   48, max= 4240, per=53.97%, avg=2703.92, stdev=954.96, samples=667
   iops        : min=   12, max= 1060, avg=675.97, stdev=238.74, samples=667
  write: IOPS=537, BW=2150KiB/s (2202kB/s)(378MiB/180002msec)
    slat (usec): min=3, max=326, avg=15.82, stdev= 5.97
    clat (usec): min=47, max=9932, avg=125.27, stdev=128.47
     lat (usec): min=55, max=9956, avg=141.65, stdev=129.01
    clat percentiles (usec):
     |  1.00th=[   67],  5.00th=[   76], 10.00th=[   81], 20.00th=[   88],
     | 30.00th=[   94], 40.00th=[  100], 50.00th=[  106], 60.00th=[  116],
     | 70.00th=[  127], 80.00th=[  147], 90.00th=[  184], 95.00th=[  212],
     | 99.00th=[  330], 99.50th=[  562], 99.90th=[ 1237], 99.95th=[ 1778],
     | 99.99th=[ 6128]
   bw (  KiB/s): min=   16, max= 1912, per=53.98%, avg=1160.48, stdev=426.25, samples=667
   iops        : min=    4, max=  478, avg=290.11, stdev=106.57, samples=667
  lat (usec)   : 50=0.01%, 100=12.82%, 250=17.58%, 500=0.51%, 750=14.91%
  lat (usec)   : 1000=22.00%
  lat (msec)   : 2=28.10%, 4=3.26%, 10=0.55%, 20=0.13%, 50=0.06%
  lat (msec)   : 100=0.03%, 250=0.02%, 500=0.01%, 750=0.01%, 1000=0.01%
  cpu          : usr=0.66%, sys=1.94%, ctx=324632, majf=0, minf=8
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=225465,96766,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=5010KiB/s (5131kB/s), 5010KiB/s-5010KiB/s (5131kB/s-5131kB/s), io=881MiB (924MB), run=180002-180002msec
  WRITE: bw=2150KiB/s (2202kB/s), 2150KiB/s-2150KiB/s (2202kB/s-2202kB/s), io=378MiB (396MB), run=180002-180002msec

Disk stats (read/write):
  vdb: ios=225317/96713, merge=0/0, ticks=339575/22895, in_queue=362816, util=99.90%
```

```shell
[root@localhost ~]# fio -filename=/data/emcpowerb -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=libaio -bs=4k -size=10G -numjobs=50 -runtime=180 -group_reporting -name=randwrite_read70_write30_4k
```

```shell
randwrite_read70_write30_4k: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1
...
fio-3.7
Starting 50 threads
Jobs: 50 (f=50): [m(50)][100.0%][r=29.3MiB/s,w=12.5MiB/s][r=7490,w=3201 IOPS][eta 00m:00s]
randwrite_read70_write30_4k: (groupid=0, jobs=50): err= 0: pid=4906: Thu Dec 31 16:38:16 2020
   read: IOPS=4938, BW=19.3MiB/s (20.2MB/s)(3485MiB/180645msec)
    slat (usec): min=2, max=8345, avg=25.31, stdev=98.39
    clat (nsec): min=1318, max=3779.2M, avg=8025599.81, stdev=56912255.47
     lat (usec): min=70, max=3779.2k, avg=8051.53, stdev=56912.31
    clat percentiles (usec):
     |  1.00th=[    717],  5.00th=[   1237], 10.00th=[   1909],
     | 20.00th=[   3032], 30.00th=[   3785], 40.00th=[   4359],
     | 50.00th=[   4817], 60.00th=[   5342], 70.00th=[   5932],
     | 80.00th=[   6718], 90.00th=[   7832], 95.00th=[   8979],
     | 99.00th=[  70779], 99.50th=[ 183501], 99.90th=[ 467665],
     | 99.95th=[ 666895], 99.99th=[3204449]
   bw (  KiB/s): min=    7, max= 1928, per=2.24%, avg=443.40, stdev=185.24, samples=16068
   iops        : min=    1, max=  482, avg=110.80, stdev=46.32, samples=16068
  write: IOPS=2119, BW=8478KiB/s (8681kB/s)(1496MiB/180645msec)
    slat (usec): min=2, max=7483, avg=28.35, stdev=105.28
    clat (usec): min=49, max=3354.9k, avg=4733.55, stdev=48615.78
     lat (usec): min=62, max=3354.9k, avg=4762.53, stdev=48616.77
    clat percentiles (usec):
     |  1.00th=[    103],  5.00th=[    265], 10.00th=[    644],
     | 20.00th=[   1844], 30.00th=[   2737], 40.00th=[   3359],
     | 50.00th=[   3851], 60.00th=[   4359], 70.00th=[   5014],
     | 80.00th=[   5866], 90.00th=[   7046], 95.00th=[   8160],
     | 99.00th=[  10683], 99.50th=[  11731], 99.90th=[  14353],
     | 99.95th=[  17171], 99.99th=[3137340]
   bw (  KiB/s): min=    7, max=  912, per=2.26%, avg=191.51, stdev=86.00, samples=15964
   iops        : min=    1, max=  228, avg=47.82, stdev=21.50, samples=15964
  lat (usec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=0.01%, 50=0.01%
  lat (usec)   : 100=0.30%, 250=1.24%, 500=1.22%, 750=1.37%, 1000=1.98%
  lat (msec)   : 2=7.81%, 4=25.52%, 10=57.74%, 20=1.63%, 50=0.34%
  lat (msec)   : 100=0.26%, 250=0.34%, 500=0.17%, 750=0.03%, 1000=0.01%
  cpu          : usr=0.11%, sys=0.35%, ctx=1408966, majf=0, minf=58
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=892168,382860,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=19.3MiB/s (20.2MB/s), 19.3MiB/s-19.3MiB/s (20.2MB/s-20.2MB/s), io=3485MiB (3654MB), run=180645-180645msec
  WRITE: bw=8478KiB/s (8681kB/s), 8478KiB/s-8478KiB/s (8681kB/s-8681kB/s), io=1496MiB (1568MB), run=180645-180645msec

Disk stats (read/write):
  vdb: ios=892164/382869, merge=0/0, ticks=7140864/1836393, in_queue=9008473, util=100.00%
```

#### 3.2.1.6 各场景下结果汇总

> 对于固态云盘（存储集群 SSD）这个，通过提高任务数 numjobs ，还可以显著的提高 IOPS 


| 测试场景             | 任务数 | IO SIZE | 文件大小size | ioengine | IOPS             | 硬盘带宽                    | 硬盘使用率 | 平均IO时延(usec)       |
| -------------------- | ------ | ------- | ------------ | -------- | ---------------- | --------------------------- | ---------- | ---------------------- |
| 顺序读               | 2      | 4K      | 10G          | libaio   | 2511             | 9.81MiB/s                   | 98.57%     | 793.15                 |
| 顺序写               | 2      | 4K      | 10G          | libaio   | 6489             | 25.3MiB/s                   | 96.02%     | 305.40                 |
| 随机读               | 2      | 4K      | 10G          | libaio   | 1232             | 4930KiB/s                   | 99.87%     | 1618.52                |
| 随机写               | 2      | 4K      | 10G          | libaio   | 5634             | 22.0MiB/s                   | 98.64%     | 351.44                 |
| 随机读70%，随机写30% | 2      | 4K      | 10G          | libaio   | r:1252<br/>w:537 | r:5010KiB/s<br/>w:2150KiB/s | 99.9%      | r:1530.33<br/>w:141.65 |

| 测试场景             | 任务数 | IO SIZE | 文件大小size | ioengine | IOPS              | 硬盘带宽                    | 硬盘使用率 | 平均IO时延(usec)        |
| -------------------- | ------ | ------- | ------------ | -------- | ----------------- | --------------------------- | ---------- | ----------------------- |
| 顺序读               | 50     | 4K      | 10G          | libaio   | 26.4k             | 103MiB/s                    | 100%       | 1889.03                 |
| 顺序写               | 50     | 4K      | 10G          | libaio   | 11.9k             | 46.3MiB/s                   | 100%       | 4214.10                 |
| 随机读               | 50     | 4K      | 10G          | libaio   | 7028              | 27.5MiB/s                   | 100%       | 7091.76                 |
| 随机写               | 50     | 4K      | 10G          | libaio   | 6507              | 25.4MiB/s                   | 100%       | 7678.93                 |
| 随机读70%，随机写30% | 50     | 4K      | 10G          | libaio   | r:4938<br/>w:2119 | r:19.3MiB/s<br/>w:8478KiB/s | 100%       | r:8051.53<br/>w:4762.53 |